<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.com.testol.dao.ReleaseTestPaperMapper">
    <select id="getClassesByTp_id" resultMap="testPaper_classes">
        SELECT tc.*,c.*,tp.*,
            tp.create_date as tp_create_date,c.create_date as c_create_date
        FROM testpaper_classes tc JOIN classes c on c.c_id=tc.c_id JOIN testpaper tp on tp.tp_id=tc.tp_id
        WHERE tc.tp_id=#{tp_id}
    </select>

    <select id="getTestpapertByC_id" resultMap="testPaper_classes">
        SELECT * ,
            tp.create_date as tp_create_date,c.create_date as c_create_date
        FROM testpaper_classes tc
            JOIN classes c on c.c_id=tc.c_id
            JOIN testpaper tp on tp.tp_id=tc.tp_id
            LEFT JOIN user_grade ug on ug.u_id=${u_id} and ug.tp_id=tc.tp_id and ug.c_id=tc.c_id
        WHERE tc.c_id=#{c_id}
    </select>


    <resultMap id="testPaper_classes" type="TestPaper_classes">
        <id property="tc_id" column="tc_id"/>
        <result property="tp_id" column="tp_id"/>
        <result property="c_id" column="c_id"/>
        <result property="release_time" column="release_time"/>
        <result property="start_date" column="start_date"/>
        <result property="deadline" column="deadline"/>
        <result property="publishAnswer" column="publish_answer"/>
        <result property="publishScore" column="publish_score"/>
        <result property="status" column="tc_status"/>
        <association property="testPaper" javaType="TestPaper">
            <result property="tp_id" column="tp_id"/>
            <result property="number" column="number"/>
            <result property="name" column="tp_name"/>
            <result property="creator_id" column="creator_id"/>
            <result property="time" column="time"/>
            <result property="create_date" column="tp_create_date"/>
            <result property="subject_id" column="subject_id"/>
            <result property="topic_num" column="topic_num"/>
            <result property="total_score" column="total_score"/>
            <result property="pass_mark" column="pass_mark"/>
            <result property="permit_copy" column="permit_copy"/>
            <result property="disrupt_order" column="disrupt_order"/>
            <result property="repeat_test" column="repeat_test"/>
            <result property="auto_mack" column="auto_mack"/>
            <association property="userGrade" javaType="UserGrade">
                <result property="id" column="id"/>
                <result property="u_id" column="u_id"/>
                <result property="c_id" column="c_id"/>
                <result property="tp_id" column="tp_id"/>
                <result property="grade" column="grade"/>
                <result property="gradeAuto" column="gradeAuto"/>
                <result property="date" column="answer_date"/>
                <result property="answerTime" column="answer_time"/>
                <result property="status" column="ug_status"/>
            </association>
        </association>
        <association property="classes" javaType="Classes">
            <result property="c_id" column="c_id"/>
            <result property="number" column="number"/>
            <result property="name" column="c_name"/>
            <result property="introduction" column="introduction"/>
            <result property="creator_id" column="creator_id"/>
            <result property="people_num" column="people_num"/>
            <result property="joinWay" column="joinWay"/>
            <result property="create_date" column="c_create_date"/>
        </association>
    </resultMap>
</mapper>
